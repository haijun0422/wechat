(function(D){var A=[],E=/^url\(["']?([^"'\)]*)["']?\);?$/i,C=/\.png$/i,F=D.browser.msie&&D.browser.version==6;function B(){D.each(A,function(){this.refresh(true)})}D(window).resize(B);D.Poshytip=function(G,H){this.$elm=D(G);this.opts=D.extend({},D.fn.poshytip.defaults,H);this.$tip=D(['<div class="',this.opts.className,'">','<div class="tip-inner tip-bg-image"></div>','<div class="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"></div>',"</div>"].join("")).appendTo(document.body);this.$arrow=this.$tip.find("div.tip-arrow");this.$inner=this.$tip.find("div.tip-inner");this.disabled=false;this.content=null;this.init()};D.Poshytip.prototype={init:function(){A.push(this);var G=this.$elm.attr("title");this.$elm.data("title.poshytip",G!==undefined?G:null).data("poshytip",this);if(this.opts.showOn!="none"){this.$elm.bind({"mouseenter.poshytip":D.proxy(this.mouseenter,this),"mouseleave.poshytip":D.proxy(this.mouseleave,this)});switch(this.opts.showOn){case"hover":if(this.opts.alignTo=="cursor"){this.$elm.bind("mousemove.poshytip",D.proxy(this.mousemove,this))}if(this.opts.allowTipHover){this.$tip.hover(D.proxy(this.clearTimeouts,this),D.proxy(this.mouseleave,this))}break;case"focus":this.$elm.bind({"focus.poshytip":D.proxy(this.show,this),"blur.poshytip":D.proxy(this.hide,this)});break}}},mouseenter:function(G){if(this.disabled){return true}this.$elm.attr("title","");if(this.opts.showOn=="focus"){return true}this.clearTimeouts();this.showTimeout=setTimeout(D.proxy(this.show,this),this.opts.showTimeout)},mouseleave:function(H){if(this.disabled||this.asyncAnimating&&(this.$tip[0]===H.relatedTarget||jQuery.contains(this.$tip[0],H.relatedTarget))){return true}var G=this.$elm.data("title.poshytip");if(G!==null){this.$elm.attr("title",G)}if(this.opts.showOn=="focus"){return true}this.clearTimeouts();this.hideTimeout=setTimeout(D.proxy(this.hide,this),this.opts.hideTimeout)},mousemove:function(G){if(this.disabled){return true}this.eventX=G.pageX;this.eventY=G.pageY;if(this.opts.followCursor&&this.$tip.data("active")){this.calcPos();this.$tip.css({left:this.pos.l,top:this.pos.t});if(this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow}}},show:function(){if(this.disabled||this.$tip.data("active")){return}this.reset();this.update();this.display();if(this.opts.timeOnScreen){setTimeout(D.proxy(this.hide,this),this.opts.timeOnScreen)}},hide:function(){if(this.disabled||!this.$tip.data("active")){return}this.display(true)},reset:function(){this.$tip.queue([]).detach().css("visibility","hidden").data("active",false);this.$inner.find("*").poshytip("hide");if(this.opts.fade){this.$tip.css("opacity",this.opacity)}this.$arrow[0].className="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left";this.asyncAnimating=false},update:function(H,G){if(this.disabled){return}var J=H!==undefined;if(J){if(!G){this.opts.content=H}if(!this.$tip.data("active")){return}}else{H=this.opts.content}var K=this,I=typeof H=="function"?H.call(this.$elm[0],function(L){K.update(L)}):H=="[title]"?this.$elm.data("title.poshytip"):H;if(this.content!==I){this.$inner.empty().append(I);this.content=I}this.refresh(J)},refresh:function(P){if(this.disabled){return}if(P){if(!this.$tip.data("active")){return}var J={left:this.$tip.css("left"),top:this.$tip.css("top")}}this.$tip.css({left:0,top:0}).appendTo(document.body);if(this.opacity===undefined){this.opacity=this.$tip.css("opacity")}var H=this.$tip.css("background-image").match(E),N=this.$arrow.css("background-image").match(E);if(H){var M=C.test(H[1]);if(F&&M){this.$tip.css("background-image","none");this.$inner.css({margin:0,border:0,padding:0});H=M=false}else{this.$tip.prepend('<table border="0" cellpadding="0" cellspacing="0"><tr><td class="tip-top tip-bg-image" colspan="2"><span></span></td><td class="tip-right tip-bg-image" rowspan="2"><span></span></td></tr><tr><td class="tip-left tip-bg-image" rowspan="2"><span></span></td><td></td></tr><tr><td class="tip-bottom tip-bg-image" colspan="2"><span></span></td></tr></table>').css({border:0,padding:0,"background-image":"none","background-color":"transparent"}).find(".tip-bg-image").css("background-image",'url("'+H[1]+'")').end().find("td").eq(3).append(this.$inner)}if(M&&!D.support.opacity){this.opts.fade=false}}if(N&&!D.support.opacity){if(F&&C.test(N[1])){N=false;this.$arrow.css("background-image","none")}this.opts.fade=false}var G=this.$tip.find("table");if(F){this.$tip[0].style.width="";G.width("auto").find("td").eq(3).width("auto");var K=this.$tip.width(),I=parseInt(this.$tip.css("min-width")),L=parseInt(this.$tip.css("max-width"));if(!isNaN(I)&&K<I){K=I}else{if(!isNaN(L)&&K>L){K=L}}this.$tip.add(G).width(K).eq(0).find("td").eq(3).width("100%")}else{if(G[0]){G.width("auto").find("td").eq(3).width("auto").end().end().width(document.defaultView&&document.defaultView.getComputedStyle&&parseFloat(document.defaultView.getComputedStyle(this.$tip[0],null).width)||this.$tip.width()).find("td").eq(3).width("100%")}}this.tipOuterW=this.$tip.outerWidth();this.tipOuterH=this.$tip.outerHeight();this.calcPos();if(N&&this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow;this.$arrow.css("visibility","inherit")}if(P){this.asyncAnimating=true;var O=this;this.$tip.css(J).animate({left:this.pos.l,top:this.pos.t},200,function(){O.asyncAnimating=false})}else{this.$tip.css({left:this.pos.l,top:this.pos.t})}},display:function(J){var K=this.$tip.data("active");if(K&&!J||!K&&J){return}this.$tip.stop();if((this.opts.slide&&this.pos.arrow||this.opts.fade)&&(J&&this.opts.hideAniDuration||!J&&this.opts.showAniDuration)){var G={},H={};if(this.opts.slide&&this.pos.arrow){var M,I;if(this.pos.arrow=="bottom"||this.pos.arrow=="top"){M="top";I="bottom"}else{M="left";I="right"}var L=parseInt(this.$tip.css(M));G[M]=L+(J?0:(this.pos.arrow==I?-this.opts.slideOffset:this.opts.slideOffset));H[M]=L+(J?(this.pos.arrow==I?this.opts.slideOffset:-this.opts.slideOffset):0)+"px"}if(this.opts.fade){G.opacity=J?this.$tip.css("opacity"):0;H.opacity=J?0:this.opacity}this.$tip.css(G).animate(H,this.opts[J?"hideAniDuration":"showAniDuration"])}J?this.$tip.queue(D.proxy(this.reset,this)):this.$tip.css("visibility","inherit");this.$tip.data("active",!K)},disable:function(){this.reset();this.disabled=true},enable:function(){this.disabled=false},destroy:function(){this.reset();this.$tip.remove();delete this.$tip;this.content=null;this.$elm.unbind(".poshytip").removeData("title.poshytip").removeData("poshytip");A.splice(D.inArray(this,A),1)},clearTimeouts:function(){if(this.showTimeout){clearTimeout(this.showTimeout);this.showTimeout=0}if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=0}},calcPos:function(){var G={l:0,t:0,arrow:""},P=D(window),Q={l:P.scrollLeft(),t:P.scrollTop(),w:P.width(),h:P.height()},M,J,N,L,K,H;if(this.opts.alignTo=="cursor"){M=J=N=this.eventX;L=K=H=this.eventY}else{var I=this.$elm.offset(),O={l:I.left,t:I.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};M=O.l+(this.opts.alignX!="inner-right"?0:O.w);J=M+Math.floor(O.w/2);N=M+(this.opts.alignX!="inner-left"?O.w:0);L=O.t+(this.opts.alignY!="inner-bottom"?0:O.h);K=L+Math.floor(O.h/2);H=L+(this.opts.alignY!="inner-top"?O.h:0)}switch(this.opts.alignX){case"right":case"inner-left":G.l=N+this.opts.offsetX;if(G.l+this.tipOuterW>Q.l+Q.w){G.l=Q.l+Q.w-this.tipOuterW}if(this.opts.alignX=="right"||this.opts.alignY=="center"){G.arrow="left"}break;case"center":G.l=J-Math.floor(this.tipOuterW/2);if(G.l+this.tipOuterW>Q.l+Q.w){G.l=Q.l+Q.w-this.tipOuterW}else{if(G.l<Q.l){G.l=Q.l}}break;default:G.l=M-this.tipOuterW-this.opts.offsetX;if(G.l<Q.l){G.l=Q.l}if(this.opts.alignX=="left"||this.opts.alignY=="center"){G.arrow="right"}}switch(this.opts.alignY){case"bottom":case"inner-top":G.t=H+this.opts.offsetY;if(!G.arrow||this.opts.alignTo=="cursor"){G.arrow="top"}if(G.t+this.tipOuterH>Q.t+Q.h){G.t=L-this.tipOuterH-this.opts.offsetY;if(G.arrow=="top"){G.arrow="bottom"}}break;case"center":G.t=K-Math.floor(this.tipOuterH/2);if(G.t+this.tipOuterH>Q.t+Q.h){G.t=Q.t+Q.h-this.tipOuterH}else{if(G.t<Q.t){G.t=Q.t}}break;default:G.t=L-this.tipOuterH-this.opts.offsetY;if(!G.arrow||this.opts.alignTo=="cursor"){G.arrow="bottom"}if(G.t<Q.t){G.t=H+this.opts.offsetY;if(G.arrow=="bottom"){G.arrow="top"}}}this.pos=G}};D.fn.poshytip=function(J){if(typeof J=="string"){var I=arguments,H=J;Array.prototype.shift.call(I);if(H=="destroy"){this.die("mouseenter.poshytip").die("focus.poshytip")}return this.each(function(){var L=D(this).data("poshytip");if(L&&L[H]){L[H].apply(L,I)}})}var G=D.extend({},D.fn.poshytip.defaults,J);if(!D("#poshytip-css-"+G.className)[0]){D(['<style id="poshytip-css-',G.className,'" type="text/css">',"div.",G.className,"{visibility:hidden;position:absolute;top:0;left:0;}","div.",G.className," table, div.",G.className," td{margin:0;font-family:inherit;font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;}","div.",G.className," td.tip-bg-image span{display:block;font:1px/1px sans-serif;height:",G.bgImageFrameSize,"px;width:",G.bgImageFrameSize,"px;overflow:hidden;}","div.",G.className," td.tip-right{background-position:100% 0;}","div.",G.className," td.tip-bottom{background-position:100% 100%;}","div.",G.className," td.tip-left{background-position:0 100%;}","div.",G.className," div.tip-inner{background-position:-",G.bgImageFrameSize,"px -",G.bgImageFrameSize,"px;}","div.",G.className," div.tip-arrow{visibility:hidden;position:absolute;overflow:hidden;font:1px/1px sans-serif;}","</style>"].join("")).appendTo("head")}if(G.liveEvents&&G.showOn!="none"){var K=D.extend({},G,{liveEvents:false});switch(G.showOn){case"hover":this.live("mouseenter.poshytip",function(){var L=D(this);if(!L.data("poshytip")){L.poshytip(K).poshytip("mouseenter")}});break;case"focus":this.live("focus.poshytip",function(){var L=D(this);if(!L.data("poshytip")){L.poshytip(K).poshytip("show")}});break}return this}return this.each(function(){new D.Poshytip(this,G)})};D.fn.poshytip.defaults={content:"[title]",className:"tooltip",bgImageFrameSize:10,showTimeout:500,hideTimeout:100,timeOnScreen:0,showOn:"hover",liveEvents:false,alignTo:"cursor",alignX:"right",alignY:"top",offsetX:-22,offsetY:18,allowTipHover:true,followCursor:false,fade:false,slide:false,slideOffset:8,showAniDuration:300,hideAniDuration:300}})(jQuery);